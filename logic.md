# 逻辑基础

逻辑，作为一切推理的基础，对于做出正确决断起着至关重要的作用。计算机要产生正确的运算结果，必须依赖于正确的逻辑决策。从另一个角度来说，逻辑还扮演了“时间”的角色，事件A导致了事件B，则意味着事件B的发生在于事件A的发生之后。一个清晰正确的逻辑是推动计算机逐步演算最终得到正确结果的根本动力。或者，我们可以将计算机定义为，能够根据逻辑进行相应操作的机器。

那么，什么是逻辑？逻辑如何演绎推理？为什么逻辑能够驱动计算机的运行？

## 命题逻辑

我们说，一切的结果都是有原因的，或者说，所有的*结论*都是有*前提*的。或者原因的原因也是结果的原因（我打伞因为别人都打伞，别人都打伞因为天下雨了，天下雨了也是我打伞的原因），抑或结果本身就是结果的原因（这是把椅子因为这是把椅子）。我们把前提和结论称为*命题*，一般用字母$$p, q, r, \ldots$$表示。如果把所有不必要的结论去掉，仅留下结论即是前提的结论，便构成了所有逻辑推理的基础，我们称之为*原子命题*。并且，我们赋予这些原子命题一个属性，称作*真*。

为了还原之前省略的结论，或者表达出更多的结论，我们需要定义一些*逻辑连接词*，构成*非原子命题*。根据构成新命题所需要命题的个数，我们列出一些常见逻辑连接词。

### 逻辑连接词

#### 零元连接词

也称逻辑常数。零元连接词有两个，⊤表示真，⊥表示假。可以表达恒真或恒假的命题。在Julia中可用```true```和```false```分别表示。

#### 一元连接词

一元连接词有一个，称作逻辑非，表示一个命题的否定，写作¬p。在Julia中表示为```!p```。我们定义，命题p为假当且仅当其否命题¬p为真。

特别注意，一个命题并非非假即真。例如p(x)定义为"x为偶数"，那么命题p(x)的真假与变量x有关。

#### 二元连接词

两个命题p,q的合取（逻辑与）p∧q为真当且仅当p和q都为真，析取（逻辑或）p∨q为真当且仅当至少一个命题为真。需要注意，逻辑与和逻辑或与我们生活中所用的与和或概念上稍有差别。例如，生活中用“或”时，常表示二者选其一（实际为逻辑异或），而逻辑或还可以表示两者都为真。Julia中，合取和析取分别表示为```p&&q```和```p||q```。

从逻辑意义上来说，合取表示一种**极小真性**，遇假即假；析取表示一种**极大真性**，遇真即真。于是对于p∧q，若p为假，则命题为假，不必理会q；同样对于p∨q，若p为真，则命题为真，亦不必理会q。这叫合取和析取的*短路现象*。

另外一种二元连接词蕴涵，p→q为假当且仅当p为真且q为假。有的作者也将其读作“如果p，那么q”，实际上是“如果p为真，则q为真”的省略形式，不过这并没有对蕴涵做出充分解释，例如当p为假时，p→q始终为真。蕴涵在逻辑上可以理解为一种**趋真性**，也可以理解为“非p或q”。一种相似的二元连接词双向蕴涵，p↔q为真当且仅当p→q且q→p，理解为一种**等价性**。

#### 优先级

逻辑连接词其实与加减乘除无异，逻辑连接词用于对于命题进行演算，加减乘除用于对于数进行演算。故我们要注意逻辑连接词的交换性和结合性。显然，合取和析取各自都存在交换律和结合律，不过当两个连接词同时出现时，不可随意交换或结合，正如1+2×3≠1×2+3≠(1+2)×3。考虑下面这个例子：如果明天下雨或者下雪并且我没有带伞或者没穿雨靴，那么我就不去上课了。如果认为或者的优先级较高，则理解为“若(1)明天是雨雪天(2)我没有任一装备两个条件同时满足，我便不去上课了”；而倘若认为并且的优先级较高，则应理解为“只要(1)明天下雨(2)下雪且我没带伞(3)我没穿雨靴三个条件满足其一，我便不去上课了”。

为了保证表达无歧义（无”二义性“），我们规定优先级从高至低依次为：逻辑非>合取>析取>蕴涵>等价。因此，¬p||q&&r表示(¬p)||(q&&r)。所以若要优先运算逻辑或，应用括号将其括起来，例如(¬(p||q))&&r。

#### 运算律

* 交换律: $$p∧q=q∧p, p∨q=q∨p$$
* 结合律: $$(p∧q)∧r=p∧(q∧r), (p∨q)∨r=p∨(q∨r)$$
* 分配律: $$p∧(q∨r)=(p∧q)∨(p∧r)$$
* 双否律: $$¬¬p=p$$
* 对偶律(De Morgan): $$¬(p∧q)=¬p∨¬q, ¬(p∨q)=¬p∧¬q$$

#### 连接词

注意到，逻辑连接词实际上就是从逻辑常数{⊤,⊥}映射到自身的函数。零元连接词是常函数，一元连接词是一元函数，二元连接词便是二元函数。现在我们考虑所有二元连接词，总共有2⁴=16种（为什么）。上述介绍的连接词可以通过延拓包含其中8种（为什么），那么，为了表达所有有效的结论，是否需要引入其余的8种连接词呢？答案是否定的。

实际上，通过连接词的复合我们可以得到其他连接词。例如，我们可以表示⊥为¬⊤，可以表示p↔q为p→q∧q→p。因此，可以找到一些连接词，使得所有其他连接词都可以由这些连接词复合得到，并且这些连接词中没有一个可以被其他连接词表示，我们称之为逻辑连接词的*极小集*。可以证明{¬,∧},{→,¬},{∨,↔,⊥}都是极小集。

### 布尔代数

我们之前已经发现，逻辑运算与代数运算都有譬如结合律、交换律、结合律的性质。那么，是否存在一种对应，包括逻辑常数与自然数的对应，逻辑连接词与算术运算符的对应，使得，我们所做的逻辑运算就是代数运算呢？

从范畴论的角度来看，我们称这种对应为*自然变换*。我们其实已经接触过许多自然变换，譬如，我们将手指与0-10的数字对应起来，使得我们可以不需要用手指也能进行十以内的计算；又如，英汉词典将中文和英文对应起来，使得我们不论用什么语言，都能传达相同的意思。如果以一种哲学视野来看，任何人类发明的符号，不论是文字还是数字，都是为了表达某种实质。不同的时代，不同的地域，不同的文明，都会创造不同的专属的符号，但是，不同的符号终究在传递共通的概念和思想。自然变换本质上就是符号的变换，就是本质的对应。

布尔代数便是这样一种对应，它是由George Boole在1847年引进的，具体规则如下：

* 逻辑常数: $$0=⊥， 1=⊤$$
* 命题: $$x,y,z,\ldots$$
* 逻辑连接词: $$¬x=1-x, x∧y=x×y, x∨y=x+y-x×y$$

布尔代数通过代数变量表示命题，用代数运算表示出了最小集，因而可表所有逻辑连接词。故我们可以通过布尔代数进行逻辑运算。

反过来，我们考虑代数运算中加法在逻辑运算中的作用。因为布尔代数中只有0和1两个数，称为*二进数*，故加法可以看作模2加，即定义x⊕y=x+y (mod 2)。有趣的是，在二进数中，加和减是等价的（为什么）。从逻辑解释上看，p⊕q为真当且仅当p,q的真值不同，我们称这种逻辑连接词为异或，Julia中用$表示。不难证明，{∧，⊕，⊤}也是极小集。因此，我们可以说，{1,+,×}生成了布尔代数，布尔代数描述了逻辑运算。

## 谓词逻辑

回顾上节中我们提到存在一些命题，既非真亦非假，譬如命题p(x)="x是偶数"。命题的真假取决于x的值，我们称像这样可以任意取值不受约束的变量为*自由变量*，而含有自由变量的命题则称为*谓词*。因此，命题逻辑的表达能力是有限的。为了扩展表达能力，我们需要对自由变量施加*量词*约束，使之成为*束缚变量*。

### 量词

#### 概念

量词分为*存在量词*和*全称量词*。存在量词要求束缚变量至少存在一个值使得谓词成立，记作∃；全称量词要求束缚变量取所有值都要使得谓词成立，记作∀。例如，∃x:p(x)成立，因为至少对于x=2，x是偶数是成立的；而∀x:p(x)为假，因为并不是对于所有x，p(x)都成立，x=1便是反例。

一个谓词如果存在某个对自由变量的赋值，使得谓词成立，那么这个谓词称为*可满足的*；若任意赋值均能使谓词成立，则称为*恒真的*；

#### 量词的交换性

相同的量词之间是可交换的。例如令p(x,y)表示一个n×n的表格中的第x行第y列被填充，则

* $$∃x,∃y:p(x,y)⇔∃y,∃x:p(x,y)⇔∃x,y:p(x,y)$$
* $$∀x,∀y:p(x,y)⇔∀y,∀x:p(x,y)⇔∀x,y:p(x,y)$$

![](https://upload.wikimedia.org/wikipedia/commons/5/5d/Predicate_logic%3B_2_variables%3B_example_matrix_e12.svg)![](https://upload.wikimedia.org/wikipedia/commons/5/55/Predicate_logic%3B_2_variables%3B_example_matrix_a12.svg)

分别表示至少有一个格子被填充，所有格子均被填充。但是，不同的量词之间不可交换。例如：

* $$∃x,∀y:p(x,y)⇎∀y,∃x:p(x,y)$$

![](https://upload.wikimedia.org/wikipedia/commons/0/02/Predicate_logic%3B_2_variables%3B_example_matrix_e1a2.svg)![](https://upload.wikimedia.org/wikipedia/commons/6/62/Predicate_logic%3B_2_variables%3B_example_matrix_a2e1.svg)

左侧表示至少有一行格子每一列都被填充，也就是说可以有一行或多行被填充，但必然一行中只要有一个格子被填充则该行所有格子都被填充。右侧表示每一列都至少有一个格子被填充，这些被填充的格子可以在同一行，也可以在不同行。

注意到，我们实际上有：

* $$∃x,∀y:p(x,y)⇒∀y,∃x:p(x,y)$$

证明：因为$$∃x:∀y:p(x,y)$$，所以存在a，$$∀y:p(a,y)$$，即$$∀y,∃x:p(x,y)$$ ∎

我们再来看一个例子，定义一个数列{f(n)}趋向于L当且仅当$$∀d>0,∃N>0,∀n>N:|f(n)-L|< d$$。直观上说，对于任意正数d，总存在一个正数N，只要n大于N，那么f(n)和L的距离小于d成立。也就是说，除前面有限项外，f(n)可以与L任意接近。但是，如果交换前面两个量词，则命题变为从第N+1项起，f(n)与L的距离都能小于任意距离d，这是不可能的（为什么)。因此，一般来说，对于∀x,∃y:p(x,y)，y是取决于x的，不同的x能使p(x,y)成立的y不一定相同。

#### 量词与其他连接词

当量词与其他连接词同时出现时，量词的优先级处于析取与蕴涵之间。请注意以下恒等式：

1. $$¬∀x:p(x)⇔∃x:¬p(x)$$
2. $$¬∃x:p(x)⇔∀x:¬p(x)$$
3. $$∀x:p(x)∧∀x:q(x)⇔∀x:p(x)∧q(x)$$
4. $$∃x:p(x)∨∃x:q(x)⇔∃x:p(x)∨q(x)$$

在此仅证明1和3，2和4留作练习。

证明：

(1) $$¬∀x:p(x)⇔存在a，¬p(a)⇔∃x:¬p(x)$$ ∎

(3) "$$⇒$$" $$∀a:$$因为$$∀x:p(x)$$，所以$$p(a)$$，因为$$∀x:q(x)$$，所以$$q(a)$$，所以$$p(a)∧q(a)$$，故$$∀x:p(x)∧q(x)$$

"$$⇐$$"$$∀a:$$因为$$p(a)∧q(a)$$，所以$$p(a)$$，所以$$q(a)$$，故$$∀a:p(a)$$，故$$∀a:q(a)$$，即$$∀a:p(a)∧q(a)$$ ∎

### 哥德尔不完备性定理

谓词逻辑扩展了命题逻辑的表达能力，并且已经能够充分表达我们日常生活中的大部分逻辑，但是我们说，谓词逻辑的表达能力依然有限。一个简单的例子，“对于任意集合A，要么x属于A，要么x不属于A”。这个命题形式上看似能用谓词逻辑表达，实际不然，注意到这里的任意“集合A”并不是选择了某一个个体y，而是选择了多个个体构成的集合，因此并不属于谓词逻辑的表达范围。

尽管，我们可以继续扩展，使得逻辑表达能力更强。但不幸的是，哥德尔在1931年的论文中提出了不完备性定理，保证了无论如何增强逻辑表达能力，仍然有命题不能得以表达。换句话说，我们永远有无法证明的正确命题。

## 练习

1. 请用Julia验证以下结果。为了验证方便，可在julia中定义一些函数，如```lhs(p,q)=p||p&&q```等，然后验证```lhs(true,false)```为```true```等。
  * 幂等律: $$p∧p=p, q∨q=q$$
  * 吸收律: $$p∧(p∨q)=p, p∨(p∧q)=p$$
  * 蕴涵：$$p→q=¬p∨q$$
  * 异或：$$p⊕q=(p∨q)∧¬(p∧q)$$
  * 等价: $$p↔q=¬(p∨q)∨(p∧q)$$
2. 在计算机硬件中，逻辑运算是通过半导体构建逻辑门实现的。我们暂且用开关和电珠代替半导体分别表示简单命题和复合命题的真假，请尝试用电池、电线、电阻、开关和电珠构造逻辑门，画出电路图。例如，与门可以用串联电路实现，这时仅当两个开关都闭合时，电珠亮。
3. 请构造加法门ADD：输入为三个比特，其中两个表示加数和被加数，另一个表示上一位进位；输出为两个比特，一个为和数的当前位，另一个为下一位进位。如ADD(1,0,1)=(0,1)，1和0为加数被加数，1为上一位进位，和为10，当前位为0，下一位进位为1。
4. 定义逻辑连接词与非p↑q=¬(p∧q)，证明{↑}是极小集。一种证明方法是，将已知极小集用↑表出。你能找出其他的极小集吗？证明你的结论。
5. 请证明{∧，⊕，⊤}是极小集，进而证明布尔代数是逻辑连接词完备的。
6. 布尔代数保证了逻辑运算与代数运算的一致性，请用布尔代数验证运算律。
7. 实际上，布尔代数并不是唯一能实现逻辑运算的代数。1930年，Arend Heyting引入了Heyting代数，同样用1和0表示真和假，并且定义运算a⩽b当且仅当a为1且b为0，即逻辑连接词蕴涵。请证明{0,⩽}是Heyting代数的生成元，进而证明Heyting代数是逻辑连接词完备的。
8. 请证明数列$$f(n)=(1+2+\cdots+n)/n^2$$趋向于1/2。尝试给出数列趋向于无穷的定义。
9. 请证明以下恒真式，并做出直观解释。
  1. $$p→(q→(p∧q))$$
  2. $$(p→q)→((p→¬q)→¬p)$$
  3. $$(p→(q∧r))↔((p→q)∧(p→r))$$
  4. $$(¬∃x:p(x))↔(∀x:¬p(x))$$
  5. $$(∃x:p(x)∨∃x:q(x))↔(∃x:p(x)∨q(x))$$
  6. $$(∀x:p(x)→q(x))→(∀x:p(x)→∀x:q(x))$$
10. 数独是一种9×9的填数字游戏，要求每一行每一列和每一个九宫格内都有且仅有一个1-9之间的数字，假设用谓词p(x,y,z)表示第x行第y列填入数字z，请用逻辑连接词和量词表达命题“当前填字方案符合数独要求”。